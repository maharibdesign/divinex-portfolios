---
import MainLayout from '../layouts/MainLayout.astro';
if (Astro.locals.session) { return Astro.redirect('/'); }

// !!! THIS IS THE FIX !!!
// We must use the .get() method to read URL parameters.
const error = Astro.url.searchParams.get('error');
const message = Astro.url.searchParams.get('message');
---
<MainLayout title="Log In - Divinex">
  <div class="auth-container">
    <div class="auth-form-wrapper">
      <h1>Welcome Back</h1>
      <p>Log in to manage your profile.</p>
      <form method="POST" action="/api/auth/login" class="auth-form">
        <label>Email <input type="email" name="email" required /></label>
        <label>Password <input type="password" name="password" required /></label>
        <button type="submit" class="btn-primary">Log In</button>
        {error && <div class="form-message error">{error}</div>}
        {message && <div class="form-message success">{message}</div>}
      </form>
      <p class="auth-switch">Don't have an account? <a href="/signup">Sign Up</a></p>
    </div>
  </div>
</MainLayout>
<style>
  .auth-container { display: grid; place-items: center; padding: 4rem 1rem; }
  .auth-form-wrapper { max-width: 400px; width: 100%; text-align: center; }
  .auth-form { display: flex; flex-direction: column; gap: 1rem; text-align: left; margin-top: 2rem; }
  .auth-form label { font-weight: 500; }
  .auth-form input { width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-color); }
  .btn-primary { width: 100%; padding: 0.75rem; border-radius: 8px; border: none; background-color: var(--button-color); color: var(--button-text-color); font-weight: 600; cursor: pointer; }
  .form-message { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; }
  .form-message.error { color: #d8000c; background-color: #ffbaba; }
  .form-message.success { color: #4f8a10; background-color: #dff2bf; }
  .auth-switch { margin-top: 2rem; color: var(--hint-color); }
</style>